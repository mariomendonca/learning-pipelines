name: CI/CD - Spring Boot

# ğŸ¯ QUANDO o pipeline serÃ¡ executado
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# ğŸ› ï¸ JOBS: Conjunto de tarefas que serÃ£o executadas
jobs:
  build:
    runs-on: ubuntu-latest  # MÃ¡quina virtual Ubuntu que vai rodar o pipeline

    steps:
      # 1ï¸âƒ£ CHECKOUT: Baixa o cÃ³digo do repositÃ³rio
      - name: ğŸ§¾ Checkout do cÃ³digo
        uses: actions/checkout@v4

      # 2ï¸âƒ£ SETUP JAVA: Configura o ambiente Java
      - name: â˜• Configurar Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'  # DistribuiÃ§Ã£o OpenJDK (Eclipse Temurin)
          java-version: '21'       # VersÃ£o do Java (mesmo do pom.xml)

      # 3ï¸âƒ£ CACHE MAVEN: Acelera o build armazenando dependÃªncias
      - name: ğŸ’¾ Cache Maven dependencies
        uses: actions/cache@v3
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-maven-

      # 4ï¸âƒ£ BUILD: Compila o projeto (sem rodar testes ainda)
      - name: ğŸ“¦ Build com Maven
        run: mvn clean package -DskipTests

      # 5ï¸âƒ£ TESTES: Executa os testes unitÃ¡rios
      - name: ğŸ§ª Rodar testes
        run: mvn test

      # 6ï¸âƒ£ ARTEFATO: Prepara o JAR para upload
      - name: ğŸ“¤ Gerar artefato (JAR)
        run: mkdir -p artifacts && cp target/*.jar artifacts/

      # 7ï¸âƒ£ UPLOAD: Salva o JAR como artefato do GitHub Actions
      - name: ğŸ”¼ Upload do artefato
        uses: actions/upload-artifact@v4
        with:
          name: app-springboot
          path: artifacts/*.jar

